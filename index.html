    <!DOCTYPE html>
    <html lang="he" dir="rtl">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <title>ינקול'ה - הזמנות</title>
      <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;600&display=swap" rel="stylesheet" />
      <style>
        body {
          font-family: 'Rubik', sans-serif;
          background: #f0f2f5;
          margin: 0;
          padding: 0;
          color: #333;
        }
        .category-header {
          background-color: #f9f9f9;
          padding: 10px;
          margin-top: 20px;
          cursor: pointer;
          font-weight: bold;
          border: 1px solid #ccc;
          border-radius: 6px;
        }
        .category-products {
          margin-top: 10px;
        }
        .hidden {
          display: none;
        }
        table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 10px;
          table-layout: fixed;
        }
        th, td {
          padding: 12px;
          border: 1px solid #ddd;
          text-align: center;
        }
        th:nth-child(1), td:nth-child(1) {
          width: 48%;
        }
        th:nth-child(2), td:nth-child(2) {
          width: 22%;
        }
        th:nth-child(3), td:nth-child(3) {
          width: 30%;
        }
        th {
          background: #efebe9;
          color: #4e342e;
        }
        .quantity-controls {
          display: flex;
          flex-direction: row-reverse;
          align-items: center;
          gap: 8px;
        }
        .button-column {
          display: flex;
          flex-direction: column;
          gap: 4px;
        }
        .button-column button {
          padding: 4px 10px;
          font-size: 16px;
          font-weight: bold;
          border: 1px solid #ccc;
          border-radius: 4px;
          background: #eee;
          cursor: pointer;
          width: 36px;
          height: 36px;
          line-height: 1;
        }
        .quantity-controls input[type="number"] {
          width: 70px;
          height: 40px;
          text-align: center;
          font-size: 16px;
          box-sizing: border-box;
          border-radius: 8px;
          border: 1px solid #ccc;
        }
      </style>
    </head>
    <body>
    <div id="product-table"></div>
    <script>
    let products = [];
    fetch('products.json')
      .then(res => res.json())
      .then(data => {
        products = data;
        buildTable();
      });
    
    function createQuantityControl(product, index) {
      const wrapper = document.createElement('div');
      wrapper.className = 'quantity-controls';
    
      const buttonColumn = document.createElement('div');
      buttonColumn.className = 'button-column';
    
      const plus = document.createElement('button');
      plus.textContent = '+';
    
      const minus = document.createElement('button');
      minus.textContent = '-';
    
      const input = document.createElement('input');
      input.type = 'number';
      input.min = product.is_weighted ? 0.5 : 1;
      input.step = product.is_weighted ? 0.1 : 1;
      input.value = '';
      input.id = `quantity-${index}`;
    
      minus.onclick = () => {
        let val = parseFloat(input.value);
        const step = parseFloat(input.step);
        const min = parseFloat(input.min);
        if (isNaN(val)) return;
        if (val <= min) {
          input.value = '';
        } else {
          val -= step;
          input.value = val.toFixed(2);
        }
        input.dispatchEvent(new Event('input'));
      };
    
      plus.onclick = () => {
        let val = parseFloat(input.value);
        const min = parseFloat(input.min);
        const step = parseFloat(input.step);
        if (isNaN(val)) {
          val = min;
        } else {
          val += step;
        }
        input.value = val.toFixed(2);
        input.dispatchEvent(new Event('input'));
      };
    
      input.addEventListener('input', updateTotal);
    
      buttonColumn.appendChild(plus);
      buttonColumn.appendChild(minus);
      wrapper.appendChild(buttonColumn);
      wrapper.appendChild(input);
    
      return wrapper;
    }
    
    function buildTable() {
      const container = document.getElementById('product-table');
      container.innerHTML = '';
    
      const categories = [];
      const categoryMap = {};
    
      products.forEach(product => {
        const cat = product.category || 'ללא קטגוריה';
        if (!categoryMap[cat]) {
          categoryMap[cat] = [];
          categories.push(cat);
        }
        categoryMap[cat].push(product);
      });
    
      categories.forEach(category => {
        const section = document.createElement('div');
        section.className = 'category-section';
    
        const header = document.createElement('div');
        header.className = 'category-header';
        header.textContent = category;
    
        const tableWrapper = document.createElement('div');
        tableWrapper.className = 'category-products';
    
        const table = document.createElement('table');
        const headerRow = document.createElement('tr');
        ['מוצר', 'מחיר ליחידה (₪)', 'כמות'].forEach(text => {
          const th = document.createElement('th');
          th.textContent = text;
          headerRow.appendChild(th);
        });
        table.appendChild(headerRow);
    
        categoryMap[category].forEach((product, index) => {
          const row = document.createElement('tr');
    
          const nameCell = document.createElement('td');
          nameCell.textContent = product.name;
          row.appendChild(nameCell);
    
          const priceCell = document.createElement('td');
          priceCell.textContent = product.price.toFixed(2);
          row.appendChild(priceCell);
    
          const quantityCell = document.createElement('td');
          const control = createQuantityControl(product, index);
          quantityCell.appendChild(control);
          row.appendChild(quantityCell);
    
          table.appendChild(row);
        });
    
        tableWrapper.appendChild(table);
        section.appendChild(header);
        section.appendChild(tableWrapper);
        container.appendChild(section);
    
        header.addEventListener('click', () => {
          tableWrapper.classList.toggle('hidden');
        });
      });
    }

    function updateTotal() {
      let total = 0;
      products.forEach((product, index) => {
        const qtyInput = document.getElementById(`quantity-${index}`);
        const qty = parseFloat(qtyInput.value);
        if (!isNaN(qty)) {
          total += qty * product.price;
          qtyInput.classList.remove('error');
        } else {
          qtyInput.classList.remove('error');
        }
      });

      const promo = document.getElementById('promo');
      if (promo && promo.value) {
        total += parseFloat(promo.value);
      }

      const region = document.getElementById('region').value;
      let shipping = 0;
      if (["שרון", "מרכז"].includes(region)) shipping = 10;
      else if (region === "תל אביב") shipping = 20;
      else if (region === "חיפה") shipping = 30;
      else if (region === "צפון") shipping = 35;
      else if (region === "אחר") document.getElementById("shipping-note").textContent = "למשלוח יש ליצור קשר ב-0509369944";
      else document.getElementById("shipping-note").textContent = "";

      document.getElementById("total").textContent = `סה"כ: ${(total + shipping).toFixed(2)} ₪ (${shipping} ₪ משלוח)`;

      const promoContainer = document.getElementById("promo-container");
      if (total >= 300) {
        promoContainer.style.display = "block";
      } else {
        promoContainer.style.display = "none";
        document.getElementById("promo").value = "";
      }
    }
  </script>
</body>
</html>
